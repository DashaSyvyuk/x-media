{% extends "base.html.twig" %}

{% block javascripts %}
    {{ encore_entry_script_tags('home') }}
    {{ encore_entry_script_tags('product') }}
    {{ encore_entry_script_tags('cart') }}
{% endblock %}

{% block body %}

    <header>
        {% include 'partials/header.html.twig' %}
    </header>

    <section class="category product-page">
        <div class="breadcrumb">
            X-media&nbsp;&nbsp;>&nbsp;&nbsp;<a href="/">Головна</a>
            <span> > </span>
            <a href="/categories/{{ product.getCategory().slug }}">&nbsp{{ product.getCategory().title }}</a>
        </div>

        <div class="images">
            <div class="list">
                <div class="inner">
                    {% for image in product.getImages() %}
                        <img src="/{{ image.imageUrl }}" {% if loop.first %}class="active"{% endif %}>
                    {% endfor %}
                </div>
            </div>
            <div class="main">
                <img src="/{{ product.getImages()[0].imageUrl }}">
            </div>
        </div>

        <div class="detail">
            <div class="category-title">{{ product.title }}</div>
            <div class="readonly-rating">
                <span class="star-rating"></span>
                <span class="value" data-value="{{ product.getAverageRating()|round(2) }}">
                ({{ product.getAverageRating()|round(2) }})
                </span>
            </div>
            <div class="attributes">
                {% for attribute in product.getFilterAttributes() %}
                    <div class="attribute">
                        <div class="title">{{ attribute.getFilter().getTitle() }}</div>
                        <div class="value">{{ attribute.getFilterAttribute().getValue() }}</div>
                    </div>
                {% endfor %}
            </div>
            <div class="price">{{ product.getPrice()|number_format(0, '.', ' ') }} грн</div>
            <div class="add2cart">
                <div>
                    <span>Купити</span>
                    <img src="/images/cart_white.png" data-id="{{ product.id }}" data-name="{{ product.title }}" data-price="{{ product.price }}">
                </div>
            </div>
        </div>

        <div class="tabs-place">
            <div class="tabs">
                <div class="tab active" data-tab="description">Опис товару</div>
                <div class="tab" data-tab="characteristics">Характеристики</div>
                <div class="tab" data-tab="reviews">Відгуки</div>
            </div>
            <div class="content">
                <div class="content-tab active" id="description">{{ product.getDescription()|raw }}</div>
                <div class="content-tab" id="characteristics">
                    <table>
                        {% for characteristic in product.getCharacteristics() %}
                        <tr>
                            <td>{{ characteristic.getTitle() }}</td>
                            <td>{{ characteristic.getValue() }}</td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
                <div class="content-tab" id="reviews">
                    <form method="post" id="add-review">
                        <p>Залишити відгук про товар:</p>
                        <div class="rating"></div>
                        <label>
                            <span class="field">Ім'я:<span class="required">*</span></span>
                            <input type="text" name="author" id="author">
                        </label>
                        <label>
                            <span class="field">Email:</span>
                            <input type="text" name="email" id="email">
                        </label>
                        <label>
                            <span class="field">Коментар:<span class="required">*</span></span>
                            <textarea name="text" id="comment"></textarea>
                        </label>
                        <input type="hidden" name="product" value="{{ product.id }}" id="product">
                        <input type="submit" value="Відправити">
                    </form>
                    <div id="comment-list">
                        <h4>Відгуки про товар:</h4>
                        {% if product.getComments()|length %}
                            <div id="list">
                            {% for comment in product.getComments() %}
                                <div class="comment">
                                    <div class="author">{{ comment.author }}:</div>
                                    <div class="date">{{ comment.createdAt.format('Y-m-d H:i:s') }}</div>
                                    <div class="text">{{ comment.comment }}</div>
                                    {% if comment.answer|length >0 %}
                                    <div class="answer">
                                        <div class="author">X-media:</div>
                                        <div class="text">{{ comment.answer }}</div>
                                    </div>
                                    {% endif %}
                                </div>
                            {% endfor %}
                            </div>
                        {% else %}
                            <p>На даний момент відгуків про даний товар ще немає, у тебе є шанс додати перший :)</p>
                        {% endif %}
                    </div>
                </div>
                <div id="comment-popup">
                    <div>Дякуємо за відгук!<br>Відправлено на опрацювання модератором</div>
                </div>
            </div>
        </div>
    </section>

    <div id="product-preview">
        <div id="background"></div>
        <div class="products">
            {% for image in product.getImages() %}
                <div class="image">
                    <img src="/{{ image.imageUrl }}">
                </div>
            {% endfor %}
        </div>
    </div>

{% endblock %}
